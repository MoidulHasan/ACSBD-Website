<script lang="ts" setup>
import type { AccordionPassThroughOptions } from "primevue/accordion";
import type { FAQSection, FAQTab } from "~/contracts/api-contracts/faqData";

const props = defineProps<{
  faqList: FAQTab[];
  selectedFaqTab: Omit<FAQSection, "tabs">;
}>();

const handleHeaderAction = (
  index: number,
  parent: AccordionPassThroughOptions,
) => {
  const isActive = parent.state.d_activeIndex === index;
  const hasShadow = !isActive;

  return {
    class: {
      "faq-tab-header": true,
      active: isActive,
      "shadow-none": hasShadow,
    },
  };
};

const initialLength = ref(10);
const faqsToShow = computed(() => {
  return props.faqList?.slice(0, initialLength.value);
});

const showMoreFAQs = () => {
  if (initialLength.value <= props.faqList?.length) {
    initialLength.value += 10;
  }
};

watch(
  () => props.selectedFaqTab,
  (newVal, oldVal) => {
    if (oldVal.title !== newVal.title) {
      initialLength.value = 10;
    }
  },
);
</script>

<template>
  <div class="faq-tabs-container">
    <div class="faq-tabs-content">
      {{ selectedFaqTab }}
      <CommonSectionHeader
        :header="selectedFaqTab.title"
        :sub-header="selectedFaqTab.description"
      />
      <div class="mt-3 md:mt-5">
        <Accordion :active-index="0" class="mb-6">
          <AccordionTab
            v-for="(tab, index) in faqsToShow"
            :key="tab.question"
            :header="tab.question"
            :pt="{
              headerAction: ({ parent }) => handleHeaderAction(index, parent),
            }"
          >
            <p class="faq-tab-header text-regular-4 bg-primary-color-white">
              {{ tab.answer }}
            </p>
          </AccordionTab>
        </Accordion>
        <div class="flex justify-content-center">
          <Button
            v-if="faqsToShow.length !== faqList?.length"
            class="view-all-tabs mb-5 md:mb-6"
            @click="showMoreFAQs"
          >
            Load More Questions
          </Button>
        </div>
      </div>
    </div>
  </div>
</template>

<style lang="scss" scoped>
.faq-tabs-container {
  width: 100%;
  padding-top: 134px;
  background: var(--product-Front-color);
}

.faq-tabs-content {
  max-width: 1100px;
  margin: 0 auto;
  padding-left: 16px;
  padding-right: 16px;

  .view-all-tabs {
    display: flex;
    padding: 12px 48px;
    justify-content: center;
    align-items: center;
    font-size: 16px;
    font-style: normal;
    font-weight: 600;
    line-height: 24px;
    border-radius: 6px;
    border: 1px solid var(--primary-color-envitect-sam-blue);
    background: var(--primary-color-white);
    color: var(--primary-color-navy-blue);
    transition: 0.4s ease-in-out;
  }

  .view-all-tabs:hover,
  .view-all-tabs:focus {
    background: var(--primary-color-envitect-sam-blue);
    color: var(--primary-color-white);
    box-shadow: none;
  }
}

:deep(.p-accordion-tab) {
  margin-bottom: 16px;
}

::v-deep(.p-accordion-toggle-icon) {
  position: absolute !important;
  right: 10px !important;
}
</style>
